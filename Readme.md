# **Студеничник Никита гр. 253503**

# Лабораторные работы:

## Лабораторная работа 1 

1.Создайте таблицу MyTable(id number, val number)

2\. Напишите анонимный блок, который записывает в таблицу MyTable 10 000 целых случайных записей.

3\. Напишите собственную функцию, которая выводит TRUE если четных значений val в таблице MyTable больше, FALSE если больше нечетных значений и EQUAL если количество четных и нечетных равно

4\. Напишите функцию, которая по введенному значению ID, генерирует и выведет в консоль текстовое значение команды insert для вставки указанной строки

5\. Написать процедуры, реализующие DML операции (INSERT, UPDATE, DELETE) для указанной таблицы

6\. Создайте функцию, вычисляющую общее вознаграждение за год. На вход функции подаются значение месячной зарплаты и процент годовых премиальных. В общем случае общее вознаграждение= (1+ процент годовых премиальных)\*12\* значение месячной зарплаты. При этом предусмотреть что процент вводится как целое число, и требуется преобразовать его к дробному. Предусмотреть защиту от ввода некорректных данных.

## Лабораторная работа 2 

1\. Построить две таблицы STUDENTS и GROUPS реализующих соответственно справочник студентов и справочник групп

| Поле | Тип | комментарий |
| :---- | :---- | :---- |
| **STUDENTS** |  |  |
| ID | Number | Код студента |
| NAME | VARCHAR2 | Имя студента |
| GROUP\_ID | Number | Код группы |
| **GROUPS** |  |  |
| ID | Number | Код группы |
| NAME | VARCHAR2 | Название группы |
| C\_VAL | Number | Количество студентов в группе |

2\. Реализовать триггеры для таблиц задания 1 проверку целостности (проверка на уникальность полей ID), генерацию автоинкрементного ключа и проверку уникальности для поля GROUP.NAME

3\. Реализовать триггер реализующий Foreign Key с каскадным удалением между таблицами STUDENTS и GROUPS

4\. Реализовать триггер реализующий журналирование всех действий над данными таблицы STUDENTS

5\. Исходя из данных предыдущей задачи, реализовать процедуру для восстановления информации на указанный временной момент и на временное смещение

6\. Реализовать триггер, который в случае изменения данных в таблице STUDENTS будет соответственно обновлять информацию C\_VAL таблицы GROUPS

## Лабораторная работа 3

1\. Написать процедуру/функцию на вход которой подаются два текстовых параметра (dev\_schema\_name, prod\_schema\_name), которые являются названиями схем баз данных (условно схема для разработки(Dev) и промышленная схема(Prod)), на выход процедура должна предоставить перечень таблиц, которые есть в схеме Dev, но нет в Prod, либо в которых различается структура таблиц. Наименования таблиц должны быть отсортированы в соответствии с очередностью их возможного создания в схеме prod (необходимо учитывать foreign key в схеме). В случае закольцованных связей выводить соответствующее сообщение

2\. Доработать предыдущий скрипт с учетом возможности сравнения не только таблиц, но и процедур, функций, индексов пакетов

3\. Доработать предыдущий скрипт с генерацией ddl-скрипта на обновление объектов, а также с учетом необходимости удаления в схеме prod объектов, отсутствующих в схеме dev.

## Лабораторная работа №4 Динамический SQL.

В современной разработке все чаще и чаще используются ORM-механизмы, которые маскируют от пользователя SQL-код, позволяя использовать некий собственный API. Передавать данные «обернутые» в некую структуру, с тем чтобы механизм сам взаимодействовал с базой. Наше задачей будет написание такого механизма. Для этого нужно:

Разработать собственную структуру JSON либо XML формата.

Написать механизм, позволяющий реализовать на уровне АРМ механизм формирование и выполнение динамических SQL запросов:

1. SELECT: на вход подается JSON/XML (на выбор студента), где указан тип запроса (SELECT), наименования выходных столбцов, наименование таблиц, условия объединения таблиц для запроса, условия фильтрации. Необходимо реализовать парс входных данных формирование запроса и выполнение его, на выход отдать курсор.  
2. Вложенные запросы: доработать пункт 1 с тем, чтобы в качестве условия фильтрации можно было бы передать вложенный запрос (условия IN, NOT IN, EXISTS, NOT EXISTS). Сформировать запрос, выполнить его, на выход передать курсор.  
3. DML: реализовать возможность в качестве структурированного файла передавать условия для генерации и выполнения запросов INSERT, UPDATE, DELETE, с реализацией возможности в качестве фильтра передавать как условия, так и подзапросы (Аналогично блоку 2\)  
4. DDL: реализовать возможность генерации и выполнения DDL скриптов CREATE TABLE и DROP TABLE. В качестве входных данных \- структурированный файл с определением DDL-команды, названием таблицы, в случае необходимости (перечнем полей и их типов).  
5. Доработать пункт 4 с тем, чтобы одновременно с созданием таблицы генерировался триггер по генерации значения первичного ключа. 

## Лабораторная работа №5

Создание таблиц истории и возможность «откатится» к заданному времени. Генерация отчетов.

Одной из ключевых возможностей современных баз данных является возможность строить ретроспективные запросы, т.е. выполнение запросов с тем чтобы они выдали результат такой, какой он был в каком-то обозримом прошлом, либо приведение данных к какому-либо моменту в прошлом (откат изменений). В нашу задачу входит обеспечение возможности отмены выполненных изменений к какому-либо моменту в прошлом. Для этого необходимо: 

1. создать три таблицы произвольной структуры, необходимые условия: в каждой таблице необходим первичный ключ. В таблицах как минимум 3 столбца. Предусмотреть наличие внешних ключей и наличия столбцов символьного типа, цифрового типа и типа дата-время.  
2. Реализовать механизм сохранения изменений данных в этих таблицах (интересуют только DML изменения).  
3. Реализовать перегруженную пакетную процедуру на вход которой подается либо дата-время либо интервал в миллисекундах в первом случае должен происходить откат всех изменений на заданную дату-время, во втором на указанное количество миллисекунд назад.  
4. Предусмотреть процедуру создания отчета об изменениях произошедших либо с момента последнего отчета либо начиная с указанной даты-времени. В отчет должна попасть информация по каждой таблице о  количестве проделанных INSERT, UPDATE, DELETE, изменения которые отменены в отчете не должны быть указаны. Отчет необходимо формировать в формате HTML.

