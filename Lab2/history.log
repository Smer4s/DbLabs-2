fc08cc89-caf7-4f89-b174-961bc6112d6b:1739550601104:0:F:drop trigger log_students_delete;
6be456e0-ac43-4802-9e19-871096e27e07:1739550601313:0:F:drop trigger log_students_update;
a14b6a82-d839-451b-a0fa-38c673abb055:1739550601545:0:F:drop trigger log_students_create;
651ab951-ddaf-4d2b-a3f5-ec4c4e539ab3:1739550608613:84:S:create or replace procedure restore_students_at_time (\n   p_restore_time timestamp\n) is\nbegin\n    -- Удаление всех текущих записей в таблице STUDENTS\n   delete from students;\n\n    -- Восстановление данных на указанный временной момент\n   for rec in (\n      select *\n        from students_log\n       where operation_date <= p_restore_time\n       order by operation_date asc\n   ) loop\n      if rec.operation = 'CREATE' then\n         insert into students (\n            id,\n            name,\n            group_id\n         ) values ( rec.student_id,\n                    rec.student_new_name,\n                    rec.group_new_id );\n      elsif rec.operation = 'UPDATE' then\n         update students\n            set name = rec.student_new_name,\n                group_id = rec.group_new_id\n          where id = rec.student_id;\n      elsif rec.operation = 'DELETE' then\n         delete from students\n          where id = rec.student_id;\n      end if;\n   end loop;\nend;\n/
f6ec5d25-559a-4c66-a372-1910173291cf:1739550609030:4:S:commit;
f44d9646-a10b-45c0-a35d-5209b4cd2b92:1739550609166:5:S:rollback;
20fdcae1-f1bc-4e3b-8c57-35236d539ed6:1739550609444:54:S:select *\n  from students_log;
a73fc668-6557-4ab5-9fbb-b1488e5b2b20:1739550609764:44432:S:begin\n   restore_students_at_time(timestamp '2025-02-14 16:14:24');\nend;\n/
fdcea86d-8227-44c6-998f-e8206e410032:1739550654445:10:S:select *\n  from students;
7b6944b5-272c-4b4b-adb4-9a7a46e15cc1:1739550654652:0:F:begin\n   restore_students_at_offset(interval '1' day);\nend;\n/
328e1e52-c7fe-4cf2-8aa6-119f815fe7c3:1739553597303:0:F:drop trigger log_students_delete;
6e3afa62-919e-44d1-991e-b48170dff2e5:1739553597522:0:F:drop trigger log_students_update;
40b511ec-5552-4dc4-9cba-7fa1cc8a6965:1739553597771:0:F:drop trigger log_students_create;
181e4c49-734f-47c2-9105-09a628aad8d8:1739553604168:0:F:create or replace procedure restore_students_at_time (\n   p_restore_time timestamp\n) is\nbegin\n   delete from students;\n\n   for rec in (\n      select *\n        from students_log\n       where operation_date <= p_restore_time\n       order by operation_date asc\n   ) loop\n      if rec.operation = 'CREATE' then\n         insert into students (\n            id,\n            name,\n            group_id\n         ) values ( rec.student_id,\n                    rec.student_new_name,\n                    rec.group_new_id );\n      elsif rec.operation = 'UPDATE' then\n         update students\n            set name = rec.student_new_name,\n                group_id = rec.group_new_id\n          where id = rec.student_id;\n      elsif rec.operation = 'DELETE' then\n         delete from students\n          where id = rec.student_id;\n      end if;\n   end loop;\nend;\n/
